<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3 id="classes">Classes</h3><ul><li><a href="Conversation.html">Conversation</a><ul class='methods'><li data-type='method'><a href="Conversation.html#.sdkVersion">sdkVersion</a></li><li data-type='method'><a href="Conversation.html#attachment">attachment</a></li><li data-type='method'><a href="Conversation.html#botId">botId</a></li><li data-type='method'><a href="Conversation.html#channelType">channelType</a></li><li data-type='method'><a href="Conversation.html#error">error</a></li><li data-type='method'><a href="Conversation.html#keepTurn">keepTurn</a></li><li data-type='method'><a href="Conversation.html#location">location</a></li><li data-type='method'><a href="Conversation.html#logger">logger</a></li><li data-type='method'><a href="Conversation.html#MessageModel">MessageModel</a></li><li data-type='method'><a href="Conversation.html#messagePayload">messagePayload</a></li><li data-type='method'><a href="Conversation.html#nlpResult">nlpResult</a></li><li data-type='method'><a href="Conversation.html#platformVersion">platformVersion</a></li><li data-type='method'><a href="Conversation.html#postback">postback</a></li><li data-type='method'><a href="Conversation.html#properties">properties</a></li><li data-type='method'><a href="Conversation.html#rawPayload">rawPayload</a></li><li data-type='method'><a href="Conversation.html#releaseTurn">releaseTurn</a></li><li data-type='method'><a href="Conversation.html#reply">reply</a></li><li data-type='method'><a href="Conversation.html#request">request</a></li><li data-type='method'><a href="Conversation.html#sessionId">sessionId</a></li><li data-type='method'><a href="Conversation.html#text">text</a></li><li data-type='method'><a href="Conversation.html#transition">transition</a></li><li data-type='method'><a href="Conversation.html#userId">userId</a></li><li data-type='method'><a href="Conversation.html#variable">variable</a></li></ul></li><li><a href="module-Lib.MessageModel.html">MessageModel</a><ul class='methods'><li data-type='method'><a href="module-Lib.MessageModel.html#.addChannelExtensions">addChannelExtensions</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.addGlobalActions">addGlobalActions</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.attachmentConversationMessage">attachmentConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.callActionObject">callActionObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.cardConversationMessage">cardConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.cardObject">cardObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.locationActionObject">locationActionObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.locationConversationMessage">locationConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.postbackActionObject">postbackActionObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.postbackConversationMessage">postbackConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.rawConversationMessage">rawConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.shareActionObject">shareActionObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.textConversationMessage">textConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.urlActionObject">urlActionObject</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#.validateConversationMessage">validateConversationMessage</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#isValid">isValid</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#messagePayload">messagePayload</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#rawPayload">rawPayload</a></li><li data-type='method'><a href="module-Lib.MessageModel.html#validationError">validationError</a></li></ul></li><li><a href="module-Middleware.WebhookClient.html">WebhookClient</a><ul class='methods'><li data-type='method'><a href="module-Middleware.WebhookClient.html#MessageModel">MessageModel</a></li><li data-type='method'><a href="module-Middleware.WebhookClient.html#on">on</a></li><li data-type='method'><a href="module-Middleware.WebhookClient.html#receiver">receiver</a></li><li data-type='method'><a href="module-Middleware.WebhookClient.html#send">send</a></li></ul></li><li><a href="module-Testing.MockConversation.html">MockConversation</a><ul class='methods'><li data-type='method'><a href="module-Testing.MockConversation.html#.any">any</a></li><li data-type='method'><a href="module-Testing.MockConversation.html#.fromRequest">fromRequest</a></li><li data-type='method'><a href="module-Testing.MockConversation.html#getReplies">getReplies</a></li></ul></li><li><a href="NLPResult.html">NLPResult</a><ul class='methods'><li data-type='method'><a href="NLPResult.html#entityMatches">entityMatches</a></li><li data-type='method'><a href="NLPResult.html#intentMatches">intentMatches</a></li><li data-type='method'><a href="NLPResult.html#topIntentMatch">topIntentMatch</a></li></ul></li></ul><h3 id="modules">Modules</h3><ul><li><a href="module-Config.html">Config</a><ul class='methods'><li data-type='method'><a href="module-Config.html">setLogger</a></li></ul></li><li><a href="module-Lib.html">Lib</a></li><li><a href="module-Middleware.html">Middleware</a><ul class='methods'><li data-type='method'><a href="module-Middleware.html#.customComponent">customComponent</a></li><li data-type='method'><a href="module-Middleware.html#.webhookReceiver">webhookReceiver</a></li></ul></li><li><a href="module-Testing.html">Testing</a><ul class='methods'><li data-type='method'><a href="module-Testing.html#.MockRequest">MockRequest</a></li></ul></li><li><a href="module-Util.html">Util</a></li><li><a href="module-Util_MessageModel.html">Util/MessageModel</a><ul class='methods'><li data-type='method'><a href="module-Util_MessageModel.html#.cardToText">cardToText</a></li><li data-type='method'><a href="module-Util_MessageModel.html#.convertRespToText">convertRespToText</a></li></ul></li><li><a href="module-Util_Text.html">Util/Text</a><ul class='methods'><li data-type='method'><a href="module-Util_Text.html#.approxTextMatch">approxTextMatch</a></li></ul></li><li><a href="module-Util_Webhook.html">Util/Webhook</a><ul class='methods'><li data-type='method'><a href="module-Util_Webhook.html#.bodyParserRawMessageVerify">bodyParserRawMessageVerify</a></li><li data-type='method'><a href="module-Util_Webhook.html#.buildSignatureHeader">buildSignatureHeader</a></li><li data-type='method'><a href="module-Util_Webhook.html#.messageToBot">messageToBot</a></li><li data-type='method'><a href="module-Util_Webhook.html#.messageToBotWithProperties">messageToBotWithProperties</a></li><li data-type='method'><a href="module-Util_Webhook.html#.verifyMessageFormat">verifyMessageFormat</a></li></ul></li></ul><h3 id="externals">Externals</h3><ul><li><a href="external-ExpressApplication.html">ExpressApplication</a></li><li><a href="external-ExpressRequest.html">ExpressRequest</a></li><li><a href="external-ExpressResponse.html">ExpressResponse</a></li><li><a href="external-ExpressRouter.html">ExpressRouter</a></li></ul><h3 id="global">Global</h3><ul><li><a href="global.html#init">init</a></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>Oracle Bots Node.js SDK</h1><p>This SDK is the main developer resource for Oracle Bots integrations
in a Node.js express environment. This package provides two primary solutions for
custom implementations against the <a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/overview1.html">Oracle Bots</a>
platform: Running <a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/bot-components.html">Custom Component Services</a>
and/or <a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/bot-channels.html">Webhook Channels</a>.</p>
<ul>
<li><a href="#installation">Installation</a> - Installation and usage information.</li>
<li><a href="#custom-components">Custom Component</a> - Services to enrich a conversation flow with custom logic, API integrations, messages, and more.</li>
<li><a href="#webhook">Webhook</a> - Integrate with custom messaging channels using incoming/outgoing webhook.
</li>
</ul>
<hr>
<h2 id="installation">Installation</h2><pre class="prettyprint source lang-text"><code>npm install --save @oracle/bots-node-sdk</code></pre><p>Install this project as a dependency to a Node.js express project.</p>
<pre class="prettyprint source lang-javascript"><code>const express = require('express');
const OracleBot = require('@oracle/bots-node-sdk');

const app = express();
OracleBot.init(app);
// implement custom bot services... (see below)</code></pre><h3 id="custom-logging">Custom Logging</h3><p>If verbose logging details are desired, you may configure a logging utility of
your choice, and initialize the SDK accordingly.</p>
<pre class="prettyprint source lang-javascript"><code>OracleBot.init(app, {
  logger: console,
});</code></pre><h2 id="custom-components">Custom Components</h2><p>Each state within a Bot flow calls a component to perform actions ranging
from basic interactions like user input and outputting response text to
some service-specific actions like fulfilling an order or booking a flight.</p>
<p>The platform has many <a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/reference1.html">built-in components</a>
to support basic actions like setting variables, allowing OAuth, and enabling
user input. In cases where your bot design calls for unique actions outside of
these functions, you’ll be writing <a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/bot-components.html">Custom Components</a>.
These allow your bot to call REST APIs, implement business logic, transition
state, customize messages, etc.</p>
<p>This package provides the necessary middleware and libraries for incorporating
Custom Components into your Bot dialog.</p>
<ul>
<li><a href="#custom-component-service">Custom Component Service</a></li>
<li><a href="#custom-component-code">Custom Component Code</a></li>
</ul>
<h3 id="custom-component-service">Custom Component Service</h3><p>The API for exposing custom components to your bot is established using the
middleware included in this package.</p>
<p>Initializing the component middleware includes some basic configurations.
Most important is the <code>register</code> option, which specifies component
paths or component objects - telling the service where Custom Component sources
are located within your project.</p>
<ul>
<li><code>cwd</code> <strong>string</strong> - Top level directory to which all other paths are relative. <code>__dirname</code> is recommended.</li>
<li><code>register</code> <strong>(string|object(s)|function)[]</strong> - Defines component registry from array of the paths to resolve.<ul>
<li>String paths may also be directories, which are scanned recursively and added to the registry.</li>
<li>Multiple components may also be exported from a single file.</li>
</ul>
</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>const express = require('express');
const OracleBot = require('@oracle/bots-node-sdk');

const app = express();
OracleBot.init(app);

// implement custom component api
app.use('/components', OracleBot.Middleware.customComponent({
  cwd: __dirname,
  register: [
    './path/to/a/component',
    './path/to/other/components',
    './path/to/a/directory',
  ]
}));</code></pre><h3 id="custom-component-code">Custom Component Code</h3><p>Using the <code>@oracle/bots-node-sdk</code> for Custom Component development supports a
flexible approach to authoring components. This means that many structures for
the implementation of a Custom Component are possible. Whatever the approach, the
fundamental interface is required as follows:</p>
<pre class="prettyprint source lang-javascript"><code>// interface for a custom component implementation
{
  metadata(): {name: string, properties?: {[name:string]: string}, supportedActions?: string[]};
  invoke(conversation: Conversation, done: () => {}): void;
}</code></pre><p>One supported implementation is to use a simple object with <code>metadata</code> and <code>invoke</code>
members:</p>
<pre class="prettyprint source lang-javascript"><code>// mycomponent.js
module.exports = {
  metadata: () => ({
    name: 'my.custom.component',
    properties: {},
    supportedActions: []
  }),
  invoke: (conversation, done) => {
    conversation.reply('hello').transition();
    done();
  }
}</code></pre><p>You may also wish to define a component by exporting class(es) and <strong>optionally</strong>
extending the <code>ComponentAbstract</code> class for additional convenience members.
<strong>NOTE</strong> Component classes are instantiated as <em>singletons</em>.</p>
<pre class="prettyprint source lang-javascript"><code>// mycomponent.js
const { ComponentAbstract } = require('@oracle/bots-node-sdk/lib');

module.exports = class MyComponent extends ComponentAbstract {
  metadata() {
    return {
      name: 'my.custom.component',
      properties: {},
      supportedActions: []
    }
  }
  invoke(conversation, done) {
    conversation.reply('hello').transition();
    done();
  }
}</code></pre><h2 id="webhook">Webhook</h2><p>The fundamental mechanism for sending and receiving messages with the Bot platform
is through <em>asynchronous</em> inbound and outbound messaging. The platform supports
several <strong>built-in</strong> channels natively, and <strong>webhook</strong> for any other messaging
service or client.</p>
<p>Implementing webhook as a channel can differ greatly across clients. Generally
each client uses a unique message format, and different mechanisms for sending or
receiving messages. This package includes these necessary integration tools.</p>
<ul>
<li><a href="#webhook-client">Webhook Client</a></li>
<li><a href="#webhook-utils">Webhook Utils</a></li>
</ul>
<h3 id="webhook-client">Webhook Client</h3><p><code>WebhookClient</code> is a flexible library for integrating with webhook channels
configured within your bot. Refer to the documentation and examples to further
understand ways the webhook client may be implemented.</p>
<pre class="prettyprint source lang-javascript"><code>const express = require('express');
const OracleBot = require('@oracle/bots-node-sdk');

const app = express();
OracleBot.init(app);

// implement webhook
const { WebhookClient, WebhookEvent } = OracleBot.Middleware;

const channel = {
  url: process.env.BOT_WEBHOOK_URL,
  secret: process.env.BOT_WEBHOOK_SECRET
};
const webhook = new WebhookClient({ channel: channel });
webhook.on(WebhookEvent.ERROR, console.error); // receive errors

// receive bot messages
app.post('/bot/message', webhook.receiver()); // receive bot messages
webhook.on(WebhookEvent.MESSAGE_RECEIVED, message => {
  // format and send to messaging client...
});

// send messages to bot (example)
app.post('/user/message', (req, res) => {
  let message = {/* ... */}; // format according to MessageModel
  webhook.send(message)
    .then(() => res.send('ok'), e => res.status(400).end());
});</code></pre><blockquote>
<p><strong>TIP</strong> <code>send()</code> supports an <em>optional</em> <code>channel</code> as its
second argument, thereby handling request-specific channel determination.</p>
</blockquote>
<h3 id="webhook-utilities">Webhook Utilities</h3><p>While <code>WebhookClient</code> is designed to support the majority of possible integration
types, there may be cases where further control is needed. For this reason, and
to support the full spectrum of integration designs, a series of utilities are
exposed directly for interfacing with the platform's webhook channel.</p>
<pre class="prettyprint source lang-javascript"><code>const { webhookUtil } = require('@oracle/bots-node-sdk/util');
// ...
webhookUtil.messageToBotWithProperties(url, secret, userId, messsage, extras, (err, result) => {

});</code></pre><h2 id="message-formatting">Message Formatting</h2><p>The Oracle Bots platform supports several
<a href="https://docs.oracle.com/en/cloud/paas/mobile-autonomous-cloud/use-chatbot/bot-channels.html">message formats</a>,
as defined by the <code>MessageModel</code> class.</p>
<p>The class provides several static methods used to create a stuctured object of a
known Common Message Model message such as Text, Card, Attachment, Location,
Postback or Raw type. It can be used within Custom Components, Webhook, or
independently. In addition, MessageModel can be used in browsers. When used in
browser, include the package <code>joi-browser</code>.</p>
<pre class="prettyprint source lang-javascript"><code>const { MessageModel } = require('@oracle/bots-node-sdk/lib');
// or
const OracleBot = require('@oracle/bots-node-sdk');
const { MessageModel } = OracleBot.Lib;</code></pre><blockquote>
<p><strong>TIP:</strong> Use <code>conversation.MessageModel()</code> to access from within a Custom
Component invoke method.
<strong>TIP:</strong> Use <code>webhook.MessageModel()</code> to access from within a <code>WebhookClient</code>
instance.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>textConversationMessage</code></td>
<td>Basic text</td>
<td><code>inbound</code>, <code>outbound</code></td>
</tr>
<tr>
<td><code>attachmentConversationMessage</code></td>
<td>Support media URLs</td>
<td><code>inbound</code>, <code>outbound</code></td>
</tr>
<tr>
<td><code>cardConversationMessage</code></td>
<td>Card presentation</td>
<td><code>outbound</code></td>
</tr>
<tr>
<td><code>postbackConversationMessage</code></td>
<td>Submit postback payloads</td>
<td><code>inbound</code></td>
</tr>
<tr>
<td><code>locationConversationMessage</code></td>
<td>Receive location payload</td>
<td><code>inbound</code></td>
</tr>
<tr>
<td><code>rawConversationMessage</code></td>
<td>Freeform payload</td>
<td><code>inbound</code>, <code>outbound</code></td>
</tr>
</tbody>
</table>
<h3 id="messagemodel-utilities">MessageModel Utilities</h3><p>Additionally, a set of utilities for MessageModel are provided. <code>Util.MessageModel</code>
functions help deriving string or speech representation of a Conversation Message
Model payload. This is used primarily to output text or speech to voice or
text-based channels like Alexa and SMS.</p>
<pre class="prettyprint source lang-javascript"><code>const { messageModelUtil } = require('@oracle/bots-node-sdk/util');
// ...
messageModelUtil.convertRespToText(message);</code></pre><h2 id="unit-testing">Unit Testing</h2><p>The SDK also includes unit testing facilities, which can be utilized within
your preferred test runner.</p>
<pre class="prettyprint source lang-javascript"><code>const Tester = require('@oracle/bots-node-sdk/testing');
const { MyComponent } = require('../../components/MyComponent');

describe('MyComponent', () => {
  it('should chat', done => {
    const conv = Tester.MockConversation.any();
    new MyComponent().invoke(conv, () => {
      // check replies
      expect(conv.getReplies().length).toBeGreaterThan(0);
      // check transition
      expect(conversation.response().transition).toBe(true);
      // check variables
      expect(conversation.variable('abc')).toEqual('xyz');
      done();
    });
  });
});</code></pre><h2 id="using-typescript">Using TypeScript</h2><p>This package includes <code>types</code>, and can therefore be used directly with TypeScript.</p>
<pre class="prettyprint source lang-typescript"><code>import { Lib } from '@oracle/bots-node-sdk';

class MyCustomComponent implements Lib.IComponent {
  public metadata(): Lib.IComponentMetadata {
    return { name: 'my.custom.component' }
  }
  public invoke(conversation: Lib.Conversation, done: () => void): void {
    // ...
  }
}</code></pre><h2 id="license">License</h2><p>Copyright © 2018, Oracle and/or its affiliates. All rights reserved.</p>
<p>The Universal Permissive License (UPL), Version 1.0</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Aug 06 2018 15:33:48 GMT-0600 (MDT) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>